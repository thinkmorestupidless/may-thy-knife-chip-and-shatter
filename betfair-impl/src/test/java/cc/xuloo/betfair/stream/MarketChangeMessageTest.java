package cc.xuloo.betfair.stream;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.joda.JodaModule;
import org.junit.Test;

import java.io.IOException;

public class MarketChangeMessageTest {

    public static String VALID_JSON = "{\"op\":\"mcm\",\"initialClk\":\"yxv3zrLSFcsbjeHHuRXLG6Gr9M0V\",\"clk\":\"AAAAAAAA\",\"conflateMs\":180000,\"heartbeatMs\":5000,\"pt\":1514705103293,\"ct\":\"SUB_IMAGE\",\"mc\":[{\"id\":\"1.138275066\",\"marketDefinition\":{\"bspMarket\":false,\"turnInPlayEnabled\":true,\"persistenceEnabled\":true,\"marketBaseRate\":5,\"eventId\":\"28526003\",\"eventTypeId\":\"1\",\"numberOfWinners\":1,\"bettingType\":\"ODDS\",\"marketType\":\"MATCH_ODDS\",\"marketTime\":\"2018-01-01T15:00:00.000Z\",\"suspendTime\":\"2018-01-01T15:00:00.000Z\",\"bspReconciled\":false,\"complete\":true,\"inPlay\":false,\"crossMatching\":true,\"runnersVoidable\":false,\"numberOfActiveRunners\":3,\"betDelay\":0,\"status\":\"OPEN\",\"runners\":[{\"status\":\"ACTIVE\",\"sortPriority\":1,\"id\":7536171},{\"status\":\"ACTIVE\",\"sortPriority\":2,\"id\":1282854},{\"status\":\"ACTIVE\",\"sortPriority\":3,\"id\":58805}],\"regulators\":[\"MR_INT\"],\"countryCode\":\"GB\",\"discountAllowed\":true,\"timezone\":\"Europe/London\",\"openDate\":\"2018-01-01T15:00:00.000Z\",\"version\":1986317602,\"priceLadderDefinition\":{\"type\":\"CLASSIC\"}},\"rc\":[{\"atb\":[[2.58,0.74],[1.01,211.83],[1.89,78.65],[2.7,1.55],[2.68,1.92],[2.32,63.63],[2.5,30.66],[2.56,29.48]],\"atl\":[[4.3,6],[7.6,26],[5.4,16],[3.3,11.54],[3.35,1.92],[940,0.07],[380,1.78]],\"trd\":[[2.74,2.96],[2.72,2.96]],\"batb\":[[2,2.56,30.22],[6,1.01,211.83],[5,1.89,78.65],[4,2.32,63.63],[3,2.5,30.66],[1,2.68,1.92],[0,2.7,1.55]],\"batl\":[[2,4.3,6],[4,7.6,26],[3,5.4,16],[6,940,0.07],[5,380,1.78],[0,3.3,11.54],[1,3.35,1.92]],\"bdatb\":[[2,2.56,30.22],[7,1.01,211.83],[0,2.7,1.55],[1,2.68,1.92],[3,2.5,30.66],[4,2.4,3.71],[5,2.32,64.12],[6,1.89,78.65],[8,0,0],[9,0,0]],\"bdatl\":[[5,4.3,6],[0,3.3,12.08],[1,3.35,3.9],[2,3.4,3.03],[4,3.8,1.1],[7,7.6,26],[6,5.4,16],[8,380,1.78],[9,940,0.07],[3,3.65,22.76]],\"ltp\":2.72,\"tv\":5.92,\"id\":1282854},{\"atb\":[[3.45,4.2],[3.35,25.1],[2.94,25.77],[3.65,2.3],[3.55,0.07],[3.6,27.1],[1.01,63.83],[2.98,49.57],[1.25,2],[3.2,20.9]],\"atl\":[[5.1,4.1],[5.8,20.02],[5.9,5],[4.6,1.94],[4.7,9.5],[95,3],[940,0.07],[180,1.78],[950,2.2]],\"trd\":[[3.55,2.96],[3.6,2.96]],\"batb\":[[8,1.01,63.83],[7,1.25,2],[6,2.94,25.77],[5,2.98,49.57],[4,3.2,20.9],[3,3.35,25.1],[2,3.45,4.27],[1,3.6,27.1],[0,3.65,2.3]],\"batl\":[[7,950,2.27],[6,180,1.78],[5,95,3],[4,5.9,5],[3,5.8,20.02],[2,5.1,4.1],[1,4.7,9.5],[0,4.6,1.94]],\"bdatb\":[[2,3.45,4.27],[3,3.35,25.1],[4,3.2,20.9],[5,3,3.35],[6,2.98,51.35],[7,2.94,25.77],[8,1.25,2],[9,1.01,63.83],[0,3.65,2.3],[1,3.6,27.1]],\"bdatl\":[[7,6.2,10.97],[2,5,1.9],[4,5.5,1.72],[3,5.1,4.1],[5,5.8,20.02],[6,5.9,5],[8,95,3],[9,180,1.78],[1,4.7,9.5],[0,4.6,1.94]],\"ltp\":3.55,\"tv\":5.92,\"id\":58805},{\"atb\":[[2.38,0.74],[1.01,211.83],[1.7,100],[2.34,1.92],[2.36,5.27],[2.08,71.03],[2.18,38.98],[2.24,37.09]],\"atl\":[[3.15,6],[3.7,16],[4.8,26],[2.72,3.7],[2.76,1.92],[2.8,40],[940,0.07],[380,1.78]],\"trd\":[[2.38,2.96],[2.36,2.96]],\"batb\":[[0,2.36,6.01],[6,1.01,211.83],[5,1.7,100],[1,2.34,1.92],[4,2.08,71.03],[3,2.18,38.98],[2,2.24,37.09]],\"batl\":[[3,3.15,6],[4,3.7,16],[5,4.8,26],[7,940,0.07],[6,380,1.78],[2,2.8,40],[1,2.76,1.92],[0,2.72,3.7]],\"bdatb\":[[0,2.36,6.01],[7,1.01,211.83],[6,1.7,100],[8,0,0],[1,2.34,1.92],[2,2.24,37.09],[3,2.18,38.98],[4,2.08,75.31],[5,2.06,14.17],[9,0,0]],\"bdatl\":[[5,3.15,6.97],[6,3.7,16],[7,4.8,26],[8,380,1.78],[9,940,0.07],[2,2.8,43.59],[3,2.82,1.49],[4,2.84,1.48],[1,2.76,1.92],[0,2.72,3.7]],\"ltp\":2.36,\"tv\":5.92,\"id\":7536171}],\"img\":true,\"tv\":17.76}]}";

    @Test
    public void testParse() throws IOException {
        ObjectMapper mapper = new ObjectMapper().registerModule(new JodaModule());

        ResponseMessage response = mapper.readValue(VALID_JSON, ResponseMessage.class);
    }
}
